package com.chainbase.udf;

import com.chainbase.utils.JSONUtils;
import com.fasterxml.jackson.databind.JsonNode;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

class GetTokenMetaTest {

  private final GetTokenMeta tokenMeta;

  public GetTokenMetaTest() throws Exception {
    tokenMeta = new GetTokenMeta();
    tokenMeta.open(null);
  }

  @Test
  void evalTestERC20() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0xd5c228427c7708a2c78ea5026b6fed44d86b7066",
            "0x60806040526006805460ff19169055600f60075560216008555f6009818155600a8281556014600b819055600c819055600d55600e92909255620000439162000340565b62000053906301312d0062000357565b600f55620000646009600a62000340565b62000074906301312d0062000357565b601055620000856009600a62000340565b62000091905f62000357565b601155620000a26009600a62000340565b620000b2906301312d0062000357565b6012556014805461ffff60a81b19169055348015620000cf575f80fd5b505f80546001600160a01b031916339081178255604051909182917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908290a35060068054610100600160a81b0319166101003302179055620001356009600a62000340565b6200014590633b9aca0062000357565b335f9081526001602081905260408220929092556003906200016e5f546001600160a01b031690565b6001600160a01b03908116825260208083019390935260409182015f908120805495151560ff1996871617905530815260039093528183208054851660019081179091556006546101009004909116835291208054909216179055620001d13390565b6001600160a01b03165f7fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef6200020a6009600a62000340565b6200021a90633b9aca0062000357565b60405190815260200160405180910390a362000371565b634e487b7160e01b5f52601160045260245ffd5b600181815b808511156200028557815f190482111562000269576200026962000231565b808516156200027757918102915b93841c93908002906200024a565b509250929050565b5f826200029d575060016200033a565b81620002ab57505f6200033a565b8160018114620002c45760028114620002cf57620002ef565b60019150506200033a565b60ff841115620002e357620002e362000231565b50506001821b6200033a565b5060208310610133831016604e8410600b841016171562000314575081810a6200033a565b62000320838362000245565b805f190482111562000336576200033662000231565b0290505b92915050565b5f6200035060ff8416836200028d565b9392505050565b80820281158282048414176200033a576200033a62000231565b611ae5806200037f5f395ff3fe608060405260043610610134575f3560e01c806372333356116100a857806395d89b411161006d57806395d89b4114610358578063a9059cbb14610384578063bf474bed146103a3578063c876d0b9146103b8578063c9567bf9146103d1578063dd62ed3e146103e5575f80fd5b806372333356146102d5578063751039fc146102f45780637d1db4a5146103085780638da5cb5b1461031d5780638f9a55c014610343575f80fd5b8063313ce567116100f9578063313ce567146102065780633bbac5791461022157806351bc3c85146102585780636de7bcbd1461026e57806370a082311461028d578063715018a6146102c1575f80fd5b806306fdde031461013f578063095ea7b3146101815780630faee56f146101b057806318160ddd146101d357806323b872dd146101e7575f80fd5b3661013b57005b5f80fd5b34801561014a575f80fd5b50604080518082019091526008815267484f424120496e7560c01b60208201525b60405161017891906115d4565b60405180910390f35b34801561018c575f80fd5b506101a061019b366004611646565b610429565b6040519015158152602001610178565b3480156101bb575f80fd5b506101c560125481565b604051908152602001610178565b3480156101de575f80fd5b506101c561043f565b3480156101f2575f80fd5b506101a0610201366004611670565b61045f565b348015610211575f80fd5b5060405160098152602001610178565b34801561022c575f80fd5b506101a061023b3660046116ae565b6001600160a01b03165f9081526004602052604090205460ff1690565b348015610263575f80fd5b5061026c6104c6565b005b348015610279575f80fd5b5061026c6102883660046116dd565b61051c565b348015610298575f80fd5b506101c56102a73660046116ae565b6001600160a01b03165f9081526001602052604090205490565b3480156102cc575f80fd5b5061026c6105b3565b3480156102e0575f80fd5b5061026c6102ef36600461179d565b610624565b3480156102ff575f80fd5b5061026c610658565b348015610313575f80fd5b506101c5600f5481565b348015610328575f80fd5b505f546040516001600160a01b039091168152602001610178565b34801561034e575f80fd5b506101c560105481565b348015610363575f80fd5b50604080518082019091526004815263484f424160e01b602082015261016b565b34801561038f575f80fd5b506101a061039e366004611646565b610713565b3480156103ae575f80fd5b506101c560115481565b3480156103c3575f80fd5b506006546101a09060ff1681565b3480156103dc575f80fd5b5061026c61071f565b3480156103f0575f80fd5b506101c56103ff3660046117bd565b6001600160a01b039182165f90815260026020908152604080832093909416825291909152205490565b5f610435338484610ac8565b5060015b92915050565b5f61044c6009600a6118e8565b61045a90633b9aca006118f6565b905090565b5f61046b848484610beb565b6104bc84336104b785604051806060016040528060288152602001611a88602891396001600160a01b038a165f9081526002602090815260408083203384529091529020549190611233565b610ac8565b5060019392505050565b60065461010090046001600160a01b0316336001600160a01b0316146104ea575f80fd5b305f908152600160205260409020548015610508576105088161126b565b47801561051857610518816113f4565b5050565b5f546001600160a01b0316331461054e5760405162461bcd60e51b81526004016105459061190d565b60405180910390fd5b5f5b815181101561051857600160045f84848151811061057057610570611942565b6020908102919091018101516001600160a01b031682528101919091526040015f20805460ff1916911515919091179055806105ab81611956565b915050610550565b5f546001600160a01b031633146105dc5760405162461bcd60e51b81526004016105459061190d565b5f80546040516001600160a01b03909116907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a35f80546001600160a01b0319169055565b5f546001600160a01b0316331461064d5760405162461bcd60e51b81526004016105459061190d565b600991909155600a55565b5f546001600160a01b031633146106815760405162461bcd60e51b81526004016105459061190d565b61068d6009600a6118e8565b61069b90633b9aca006118f6565b600f556106aa6009600a6118e8565b6106b890633b9aca006118f6565b6010556006805460ff191690557f947f344d56e1e8c70dc492fb94c4ddddd490c016aab685f5e7e47b2e85cb44cf6106f26009600a6118e8565b61070090633b9aca006118f6565b60405190815260200160405180910390a1565b5f610435338484610beb565b5f546001600160a01b031633146107485760405162461bcd60e51b81526004016105459061190d565b601454600160a01b900460ff16156107a25760405162461bcd60e51b815260206004820152601760248201527f74726164696e6720697320616c7265616479206f70656e0000000000000000006044820152606401610545565b601380546001600160a01b031916737a250d5630b4cf539739df2c5dacb4c659f2488d9081179091556107eb9030906107dd6009600a6118e8565b6104b790633b9aca006118f6565b60135f9054906101000a90046001600160a01b03166001600160a01b031663c45a01556040518163ffffffff1660e01b8152600401602060405180830381865afa15801561083b573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061085f919061196e565b6001600160a01b031663c9c653963060135f9054906101000a90046001600160a01b03166001600160a01b031663ad5c46486040518163ffffffff1660e01b8152600401602060405180830381865afa1580156108be573d5f803e3d5ffd5b505050506040513d601f19601f820116820180604052508101906108e2919061196e565b6040516001600160e01b031960e085901b1681526001600160a01b039283166004820152911660248201526044016020604051808303815f875af115801561092c573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610950919061196e565b601480546001600160a01b039283166001600160a01b03199091161790556013541663f305d7194730610997816001600160a01b03165f9081526001602052604090205490565b5f806109aa5f546001600160a01b031690565b60405160e088901b6001600160e01b03191681526001600160a01b03958616600482015260248101949094526044840192909252606483015290911660848201524260a482015260c40160606040518083038185885af1158015610a10573d5f803e3d5ffd5b50505050506040513d601f19601f82011682018060405250810190610a359190611989565b505060145460135460405163095ea7b360e01b81526001600160a01b0391821660048201525f1960248201529116915063095ea7b3906044016020604051808303815f875af1158015610a8a573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610aae91906119b4565b506014805462ff00ff60a01b19166201000160a01b179055565b6001600160a01b038316610b2a5760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b6064820152608401610545565b6001600160a01b038216610b8b5760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b6064820152608401610545565b6001600160a01b038381165f8181526002602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b6001600160a01b038316610c4f5760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b6064820152608401610545565b6001600160a01b038216610cb15760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b6064820152608401610545565b5f8111610d125760405162461bcd60e51b815260206004820152602960248201527f5472616e7366657220616d6f756e74206d7573742062652067726561746572206044820152687468616e207a65726f60b81b6064820152608401610545565b5f80546001600160a01b03858116911614801590610d3d57505f546001600160a01b03848116911614155b156110f6576001600160a01b0384165f9081526004602052604090205460ff16158015610d8257506001600160a01b0383165f9081526004602052604090205460ff16155b610d8a575f80fd5b60065460ff1615610e41576013546001600160a01b03848116911614801590610dc157506014546001600160a01b03848116911614155b15610e4157325f908152600560205260409020544311610e2f5760405162461bcd60e51b8152602060048201526024808201527f4f6e6c79206f6e65207472616e736665722070657220626c6f636b20616c6c6f6044820152633bb2b21760e11b6064820152608401610545565b325f9081526005602052604090204390555b6014546001600160a01b038581169116148015610e6c57506013546001600160a01b03848116911614155b8015610e9057506001600160a01b0383165f9081526003602052604090205460ff16155b15610f8957600f54821115610ee35760405162461bcd60e51b815260206004820152601960248201527822bc31b2b2b239903a3432902fb6b0bc2a3c20b6b7bab73a1760391b6044820152606401610545565b60105482610f05856001600160a01b03165f9081526001602052604090205490565b610f0f91906119d3565b1115610f5d5760405162461bcd60e51b815260206004820152601a60248201527f4578636565647320746865206d617857616c6c657453697a652e0000000000006044820152606401610545565b600d54600e541015610f7457823b15610f74575f80fd5b600e8054905f610f8383611956565b91905055505b610fb56064610faf600b54600e5411610fa457600754610fa8565b6009545b859061142f565b906114b4565b6014549091506001600160a01b038481169116148015610fde57506001600160a01b0384163014155b1561105957600f548211156110315760405162461bcd60e51b815260206004820152601960248201527822bc31b2b2b239903a3432902fb6b0bc2a3c20b6b7bab73a1760391b6044820152606401610545565b6110566064610faf600c54600e541161104c57600854610fa8565b600a54859061142f565b90505b305f90815260016020526040902054601454600160a81b900460ff1615801561108f57506014546001600160a01b038581169116145b80156110a45750601454600160b01b900460ff165b80156110b1575060115481115b80156110c05750600d54600e54115b156110f4576110e26110dd846110d8846012546114f5565b6114f5565b61126b565b4780156110f2576110f2476113f4565b505b505b801561116e57305f908152600160205260409020546111159082611509565b305f81815260016020526040908190209290925590516001600160a01b038616907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef906111659085815260200190565b60405180910390a35b6001600160a01b0384165f908152600160205260409020546111909083611567565b6001600160a01b0385165f908152600160205260409020556111d36111b58383611567565b6001600160a01b0385165f9081526001602052604090205490611509565b6001600160a01b038085165f8181526001602052604090209290925585167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef61121c8585611567565b60405190815260200160405180910390a350505050565b5f81848411156112565760405162461bcd60e51b815260040161054591906115d4565b505f61126284866119e6565b95945050505050565b6014805460ff60a81b1916600160a81b17905580156113e457601454600160a01b900460ff16156113e4576040805160028082526060820183525f9260208301908036833701905050905030815f815181106112c9576112c9611942565b6001600160a01b03928316602091820292909201810191909152601354604080516315ab88c960e31b81529051919093169263ad5c46489260048083019391928290030181865afa158015611320573d5f803e3d5ffd5b505050506040513d601f19601f82011682018060405250810190611344919061196e565b8160018151811061135757611357611942565b6001600160a01b03928316602091820292909201015260135461137d9130911684610ac8565b60135460405163791ac94760e01b81526001600160a01b039091169063791ac947906113b59085905f908690309042906004016119f9565b5f604051808303815f87803b1580156113cc575f80fd5b505af11580156113de573d5f803e3d5ffd5b50505050505b506014805460ff60a81b19169055565b6006546040516101009091046001600160a01b0316906108fc8315029083905f818181858888f19350505050158015610518573d5f803e3d5ffd5b5f825f0361143e57505f610439565b5f61144983856118f6565b9050826114568583611a68565b146114ad5760405162461bcd60e51b815260206004820152602160248201527f536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f6044820152607760f81b6064820152608401610545565b9392505050565b5f6114ad83836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f0000000000008152506115a8565b5f81831161150357826114ad565b50919050565b5f8061151583856119d3565b9050838110156114ad5760405162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f7700000000006044820152606401610545565b5f6114ad83836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250611233565b5f81836115c85760405162461bcd60e51b815260040161054591906115d4565b505f6112628486611a68565b5f6020808352835180828501525f5b818110156115ff578581018301518582016040015282016115e3565b505f604082860101526040601f19601f8301168501019250505092915050565b6001600160a01b0381168114611633575f80fd5b50565b80356116418161161f565b919050565b5f8060408385031215611657575f80fd5b82356116628161161f565b946020939093013593505050565b5f805f60608486031215611682575f80fd5b833561168d8161161f565b9250602084013561169d8161161f565b929592945050506040919091013590565b5f602082840312156116be575f80fd5b81356114ad8161161f565b634e487b7160e01b5f52604160045260245ffd5b5f60208083850312156116ee575f80fd5b823567ffffffffffffffff80821115611705575f80fd5b818501915085601f830112611718575f80fd5b81358181111561172a5761172a6116c9565b8060051b604051601f19603f8301168101818110858211171561174f5761174f6116c9565b60405291825284820192508381018501918883111561176c575f80fd5b938501935b828510156117915761178285611636565b84529385019392850192611771565b98975050505050505050565b5f80604083850312156117ae575f80fd5b50508035926020909101359150565b5f80604083850312156117ce575f80fd5b82356117d98161161f565b915060208301356117e98161161f565b809150509250929050565b634e487b7160e01b5f52601160045260245ffd5b600181815b8085111561184257815f1904821115611828576118286117f4565b8085161561183557918102915b93841c939080029061180d565b509250929050565b5f8261185857506001610439565b8161186457505f610439565b816001811461187a5760028114611884576118a0565b6001915050610439565b60ff841115611895576118956117f4565b50506001821b610439565b5060208310610133831016604e8410600b84101617156118c3575081810a610439565b6118cd8383611808565b805f19048211156118e0576118e06117f4565b029392505050565b5f6114ad60ff84168361184a565b8082028115828204841417610439576104396117f4565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b634e487b7160e01b5f52603260045260245ffd5b5f60018201611967576119676117f4565b5060010190565b5f6020828403121561197e575f80fd5b81516114ad8161161f565b5f805f6060848603121561199b575f80fd5b8351925060208401519150604084015190509250925092565b5f602082840312156119c4575f80fd5b815180151581146114ad575f80fd5b80820180821115610439576104396117f4565b81810381811115610439576104396117f4565b5f60a082018783526020878185015260a0604085015281875180845260c08601915082890193505f5b81811015611a475784516001600160a01b031683529383019391830191600101611a22565b50506001600160a01b03969096166060850152505050608001529392505050565b5f82611a8257634e487b7160e01b5f52601260045260245ffd5b50049056fe45524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e6365a26469706673582212204d700ea5be2f28e0f791b5f80571b231258cf5340b58682122dca25ffe8e7b5964736f6c63430008140033"
    );

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertTrue(json.get("is_erc20").asBoolean());
    Assertions.assertEquals("HOBA", json.get("symbol").asText());
    Assertions.assertEquals("HOBA Inu", json.get("name").asText());
    Assertions.assertEquals(9, json.get("decimals").asInt());
  }

  @Test
  void evalTestERC72_WithProxy() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0x575652cd1501f1ffc50232457fd5c7f317996431",
            "0x363d3d373d3d3d363d730a252663dbcc0b073063d6420a40319e438cfa595af43d82803e903d91602b57fd5bf3"
    );
    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertTrue(json.get("is_erc721").asBoolean());
  }

  @Test
  void evalTestERC721() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0x0a252663DBCc0b073063D6420a40319e438Cfa59",
            "0x608060405234801561001057600080fd5b506004361061021f5760003560e01c806370a082311161012c57806370a08231146103fb57806371141a581461040e57806374a1dff21461043557806389776eb0146104485780638da5cb5b1461045b578063928dd2a71461048157806395d89b411461048957806398bdf6f5146104915780639dc29fac1461049a578063a126ad1e146104ad578063a1a53fa1146104b7578063a22cb465146104d7578063b88d4fde146104ea578063ba3ec741146104fd578063bd33303314610505578063c87b56dd14610525578063d0d5f5b414610538578063df0030ef1461054b578063e3af6d0a1461055e578063e985e9c514610585578063ecef920114610598578063ee8743d7146105ab578063f5878b9b146105c057600080fd5b806301bb41161461022457806301ffc9a714610239578063044db8ba1461026157806306fdde0314610277578063081812fc1461028c578063095ea7b3146102ac57806319cba6b4146102bf57806323b872dd146102d45780632a55205a146102e757806341b169f31461030857806341f434341461031157806342842e0e14610326578063443aa53314610339578063498a4c2d146103595780634d4b2be41461038057806353b18de414610389578063543746b11461039c57806355ee08ba146103af578063572b6c05146103b75780635c41d2fe146103ca5780636352211e146103dd578063700107af146103f0575b600080fd5b6102376102323660046133b6565b6105d3565b005b61024c6102473660046133e5565b610726565b60405190151581526020015b60405180910390f35b61026960fa81565b604051908152602001610258565b61027f610787565b6040516102589190613452565b61029f61029a3660046133b6565b610819565b6040516102589190613465565b6102376102ba36600461348e565b610840565b6102c7610854565b60405161025891906134ba565b6102376102e23660046134fe565b6108d5565b6102fa6102f536600461353f565b610900565b604051610258929190613561565b610269611d4c81565b61029f6daaeb6d7670e522a718067333cd4e81565b6102376103343660046134fe565b610944565b6102696103473660046133b6565b600d6020526000908152604090205481565b6102697f0000000000000000000000000000000000000000000000000000000000f8b9f081565b61026961271181565b61026961039736600461357a565b610969565b6102376103aa36600461348e565b610d34565b610269606381565b61024c6103c53660046135a6565b610f27565b6102376103d83660046135a6565b610f3b565b61029f6103eb3660046133b6565b611027565b6102696301e1338081565b6102696104093660046135a6565b61105c565b61029f7f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb881565b6102696104433660046133b6565b6110e2565b6102696104563660046133b6565b611103565b7f000000000000000000000000c73fc08c931efe3fce850c09278472e8a81c2e0561029f565b610237611113565b61027f61115f565b61026960075481565b6102376104a836600461348e565b61116e565b61026962093a8081565b6102696104c53660046133b6565b600b6020526000908152604090205481565b6102376104e53660046135d1565b6114db565b6102376104f8366004613677565b6114ef565b61027f61151c565b6102696105133660046133b6565b600c6020526000908152604090205481565b61027f6105333660046133b6565b611538565b6102696105463660046133b6565b611715565b6102376105593660046135a6565b611725565b6102697f0000000000000000000000000000000000000000000000000000000063ae743381565b61024c610593366004613725565b6117ea565b6102696105a636600461353f565b611818565b61024c6105b93660046133b6565b6127111190565b6102376105ce366004613753565b611984565b336001600160a01b037f0000000000000000000000000a252663dbcc0b073063d6420a40319e438cfa5916146106245760405162461bcd60e51b815260040161061b90613778565b60405180910390fd5b60008160405160240161063991815260200190565b60408051601f198184030181529181526020820180516001600160e01b0316639ff054df60e01b179052519091506000906001600160a01b037f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb816906106a09084906137c5565b6000604051808303816000865af19150503d80600081146106dd576040519150601f19603f3d011682016040523d82523d6000602084013e6106e2565b606091505b50509050806107215760405162461bcd60e51b815260206004820152600b60248201526a18d85b1b0819985a5b195960aa1b604482015260640161061b565b505050565b60006001600160e01b0319821663543746b160e01b148061075757506001600160e01b0319821663152a902d60e11b145b8061077257506001600160e01b0319821663572b6c0560e01b145b80610781575061078182611e3b565b92915050565b606060018054610796906137e1565b80601f01602080910402602001604051908101604052809291908181526020018280546107c2906137e1565b801561080f5780601f106107e45761010080835404028352916020019161080f565b820191906000526020600020905b8154815290600101906020018083116107f257829003601f168201915b5050505050905090565b600061082482611e8b565b506000908152600560205260409020546001600160a01b031690565b8161084a81611eb3565b6107218383611f5b565b6060600f600061086261207d565b6001600160a01b03166001600160a01b0316815260200190815260200160002080548060200260200160405190810160405280929190818152602001828054801561080f57602002820191906000526020600020905b8154815260200190600101908083116108b8575050505050905090565b826001600160a01b03811633146108ef576108ef33611eb3565b6108fa84848461208c565b50505050565b7f0000000000000000000000003903b9cfa1680ed9663ecec7d3412305bebe326f600061271061093160fa85613831565b61093b919061385e565b90509250929050565b826001600160a01b038116331461095e5761095e33611eb3565b6108fa8484846120be565b60007f0000000000000000000000000000000000000000000000000000000000f8b9f043116109aa5760405162461bcd60e51b815260040161061b90613872565b600019600e54146109cd5760405162461bcd60e51b815260040161061b906138a1565b600084116109ed5760405162461bcd60e51b815260040161061b906138d5565b60008311610a0d5760405162461bcd60e51b815260040161061b90613903565b60016008600181548110610a2357610a23613930565b9060005260206000200154610a389190613946565b8211610a865760405162461bcd60e51b815260206004820152601d60248201527f58454e46543a206e6f7420656e6f756768206275726e20616d6f756e74000000604482015260640161061b565b60007f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb86001600160a01b03166370a08231610abf61207d565b6040518263ffffffff1660e01b8152600401610adb9190613465565b602060405180830381865afa158015610af8573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610b1c9190613959565b9050610b29600184613946565b8111610b775760405162461bcd60e51b815260206004820152601d60248201527f58454e46543a206e6f7420656e6f7567682058454e2062616c616e6365000000604482015260640161061b565b60007f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb86001600160a01b031663dd62ed3e610bb061207d565b306040518363ffffffff1660e01b8152600401610bce929190613972565b602060405180830381865afa158015610beb573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610c0f9190613959565b9050610c1c600185613946565b8111610c825760405162461bcd60e51b815260206004820152602f60248201527f58454e46543a206e6f7420656e6f7567682058454e2062616c616e636520617060448201526e383937bb32b2103337b910313ab93760891b606482015260840161061b565b610c8c86856120d9565b600e81905550610ca08686600e5487612311565b7f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb86001600160a01b0316639dc29fac610cd761207d565b866040518363ffffffff1660e01b8152600401610cf5929190613561565b600060405180830381600087803b158015610d0f57600080fd5b505af1158015610d23573d6000803e3d6000fd5b5050600e5498975050505050505050565b600019600e5403610d875760405162461bcd60e51b815260206004820152601d60248201527f58454e46543a20696c6c6567616c2063616c6c6261636b207374617465000000604482015260640161061b565b336001600160a01b037f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb81614610dff5760405162461bcd60e51b815260206004820152601e60248201527f58454e46543a20696c6c6567616c2063616c6c6261636b2063616c6c65720000604482015260640161061b565b600e546001600160a01b0383166000908152600f60205260409020610e23916124a9565b600e80546000908152600c6020526040902082905554610e44908390612523565b600e546000908152600b6020908152604080832054600d9092529182902054915163346ba94160e01b815260048101929092526001600160a01b038416917ffbb2077593b3594fd0ac359a2d898268191a74843aaf1ba3f517b5514a1b0711919073c739d01beb34e380461bba9ef8ed1a44874382be9063346ba94190602401602060405180830381865af4158015610ee1573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610f059190613959565b6040805192835260208301919091520160405180910390a25050600019600e55565b6000546001600160a01b0391821691161490565b336001600160a01b037f000000000000000000000000c73fc08c931efe3fce850c09278472e8a81c2e051614610fac5760405162461bcd60e51b81526020600482015260166024820152752c22a7232a1d103737ba1030b7103232b83637bcb2b960511b604482015260640161061b565b6000546001600160a01b0316156110055760405162461bcd60e51b815260206004820152601f60248201527f58454e46543a20466f7277617264657220697320616c72656164792073657400604482015260640161061b565b600080546001600160a01b0319166001600160a01b0392909216919091179055565b6000818152600360205260408120546001600160a01b0316806107815760405162461bcd60e51b815260040161061b9061398c565b60006001600160a01b0382166110c65760405162461bcd60e51b815260206004820152602960248201527f4552433732313a2061646472657373207a65726f206973206e6f7420612076616044820152683634b21037bbb732b960b91b606482015260840161061b565b506001600160a01b031660009081526004602052604090205490565b600981815481106110f257600080fd5b600091825260209091200154905081565b600a81815481106110f257600080fd5b336001600160a01b037f0000000000000000000000000a252663dbcc0b073063d6420a40319e438cfa59161461115b5760405162461bcd60e51b815260040161061b90613778565b6000ff5b606060028054610796906137e1565b7f0000000000000000000000000000000000000000000000000000000000f8b9f043116111ad5760405162461bcd60e51b815260040161061b90613872565b600019600e54146111d05760405162461bcd60e51b815260040161061b906139be565b6111dd6001600019613946565b600e556111e861207d565b6040516301ffc9a760e01b815263543746b160e01b60048201526001600160a01b0391909116906301ffc9a790602401602060405180830381865afa158015611235573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061125991906139f2565b6112b15760405162461bcd60e51b8152602060048201526024808201527f58454e4654206275726e3a206e6f74206120737570706f7274656420636f6e746044820152631c9858dd60e21b606482015260840161061b565b6001600160a01b0382166113115760405162461bcd60e51b815260206004820152602160248201527f58454e4654206275726e3a20696c6c6567616c206f776e6572206164647265736044820152607360f81b606482015260840161061b565b6000811161135f5760405162461bcd60e51b815260206004820152601b60248201527a161153919508189d5c9b8e881a5b1b1959d85b081d1bdad95b9259602a1b604482015260640161061b565b61137061136a61207d565b8261253d565b6113c85760405162461bcd60e51b8152602060048201526024808201527f58454e4654206275726e3a206e6f7420616e20617070726f766564206f70657260448201526330ba37b960e11b606482015260840161061b565b816001600160a01b03166113db82611027565b6001600160a01b03161461143f5760405162461bcd60e51b815260206004820152602560248201527f58454e4654206275726e3a2075736572206973206e6f7420746f6b656e49642060448201526437bbb732b960d91b606482015260840161061b565b6001600160a01b0382166000908152600f60205260409020611461908261259c565b61146a81612681565b61147261207d565b6001600160a01b031663543746b183836040518363ffffffff1660e01b815260040161149f929190613561565b600060405180830381600087803b1580156114b957600080fd5b505af11580156114cd573d6000803e3d6000fd5b5050600019600e5550505050565b816114e581611eb3565b610721838361271e565b836001600160a01b03811633146115095761150933611eb3565b61151585858585612730565b5050505050565b604051806060016040528060258152602001613e5b6025913981565b6000818152600b6020908152604080832054600d835281842054600c90935292205460609291908261156957600080fd5b600061157486612769565b604051631b9345fd60e01b81526004810188905260248101869052604481018590526001600160a01b037f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb81660648201526084810184905261163990731ac17ffb8456525bff46870bba7ed8772ba063a590631b9345fd9060a401600060405180830381865af415801561160c573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526116349190810190613a0f565b612869565b604051633c4a25e960e21b8152600481018790526024810185905260448101869052731ac17ffb8456525bff46870bba7ed8772ba063a59063f12897a490606401600060405180830381865af4158015611697573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526116bf9190810190613a0f565b6040516020016116d193929190613a85565b60405160208183030381529060405290506116eb81612869565b6040516020016116fb9190613ba3565b604051602081830303815290604052945050505050919050565b600881815481106110f257600080fd5b336001600160a01b037f0000000000000000000000000a252663dbcc0b073063d6420a40319e438cfa59161461176d5760405162461bcd60e51b815260040161061b90613778565b6000816064604051602401611783929190613561565b60408051601f198184030181529181526020820180516001600160e01b0316631c56030560e01b179052519091506000906001600160a01b037f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb816906106a09084906137c5565b6001600160a01b03918216600090815260066020908152604080832093909416825291909152205460ff1690565b60007f0000000000000000000000000000000000000000000000000000000000f8b9f043116118595760405162461bcd60e51b815260040161061b90613872565b600019600e541461187c5760405162461bcd60e51b815260040161061b906138a1565b6000831161189c5760405162461bcd60e51b815260040161061b906138d5565b600082116118bc5760405162461bcd60e51b815260040161061b90613903565b6118c78360006120d9565b600e819055506118dc8383600e546000612311565b61190d600e54600f60006118ee61207d565b6001600160a01b031681526020810191909152604001600020906124a9565b61192061191861207d565b600e54612523565b61192861207d565b6001600160a01b03167ffbb2077593b3594fd0ac359a2d898268191a74843aaf1ba3f517b5514a1b0711848460405161196b929190918252602082015260400190565b60405180910390a25050600e8054600019909155919050565b7f0000000000000000000000000000000000000000000000000000000000f8b9f043116119c35760405162461bcd60e51b815260040161061b90613872565b600019600e54146119e65760405162461bcd60e51b815260040161061b906139be565b6119f36001600019613946565b600e556119fe61207d565b6001600160a01b0316611a1083611027565b6001600160a01b031614611a5f5760405162461bcd60e51b81526020600482015260166024820152752c22a7232a1d1024b731b7b93932b1ba1037bbb732b960511b604482015260640161061b565b6001600160a01b038116611aae5760405162461bcd60e51b815260206004820152601660248201527558454e46543a20496c6c6567616c206164647265737360501b604482015260640161061b565b6000828152600d60205260409081902054905163e90cdc8960e01b8152600481019190915273c739d01beb34e380461bba9ef8ed1a44874382be9063e90cdc8990602401602060405180830381865af4158015611b0f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611b3391906139f2565b15611b7a5760405162461bcd60e51b815260206004820152601760248201527616115391950e88105b1c9958591e481c995919595b5959604a1b604482015260640161061b565b604051600090611bbe90733d602d80600a3d3981f3363d3d373d3d3d363d7360601b903060601b906e5af43d82803e903d91602b57fd5bf360881b90602001613be8565b60408051601f198184030181529181526000858152600b6020529081205491925090611beb906001613c16565b9050600083604051602401611c009190613465565b60408051601f19818403018152918152602080830180516001600160e01b0390811663df0030ef60e01b1790915282516004815260248101909352908201805190911663928dd2a760e01b17905290915060015b83811015611dbb576040805160208082018490528183018a90528251808303840181526060808401855281519183019190912089518a8401206001600160f81b031960808601523090921b6001600160601b03191660818501526095840181905260b5808501929092528451808503909201825260d5909301909352825192810192909220855191926000928291849182918a0182855af1925082611d475760405162461bcd60e51b815260206004820152602360248201527f58454e46543a204572726f72207768696c6520636c61696d696e67207265776160448201526272647360e81b606482015260840161061b565b6000808751602089016000855af1925082611da45760405162461bcd60e51b815260206004820181905260248201527f58454e46543a204572726f72207768696c6520706f776572696e6720646f776e604482015260640161061b565b505050508080611db390613c29565b915050611c54565b506000868152600d6020526040902080546001179055611dd961207d565b6001600160a01b03167f7ae39cb5fb0bebb7775f35a0009e0c94f59c2e40c8967af20842619edac4694d8787604051611e259291909182526001600160a01b0316602082015260400190565b60405180910390a25050600019600e5550505050565b60006001600160e01b031982166380ac58cd60e01b1480611e6c57506001600160e01b03198216635b5e139f60e01b145b8061078157506301ffc9a760e01b6001600160e01b0319831614610781565b611e94816129bb565b611eb05760405162461bcd60e51b815260040161061b9061398c565b50565b6daaeb6d7670e522a718067333cd4e3b15611eb057604051633185c44d60e21b81526daaeb6d7670e522a718067333cd4e9063c617113490611efb9030908590600401613972565b602060405180830381865afa158015611f18573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611f3c91906139f2565b611eb05780604051633b79c77360e21b815260040161061b9190613465565b6000611f6682611027565b9050806001600160a01b0316836001600160a01b031603611fd35760405162461bcd60e51b815260206004820152602160248201527f4552433732313a20617070726f76616c20746f2063757272656e74206f776e656044820152603960f91b606482015260840161061b565b806001600160a01b0316611fe561207d565b6001600160a01b0316148061200157506120018161059361207d565b6120735760405162461bcd60e51b815260206004820152603e60248201527f4552433732313a20617070726f76652063616c6c6572206973206e6f7420746f60448201527f6b656e206f776e6572206e6f7220617070726f76656420666f7220616c6c0000606482015260840161061b565b61072183836129d8565b6000612087612a46565b905090565b61209761136a61207d565b6120b35760405162461bcd60e51b815260040161061b90613c42565b610721838383612a68565b610721838383604051806020016040528060008152506114ef565b6000806120e583612c03565b9050806001036121a5576063841161210f5760405162461bcd60e51b815260040161061b90613c90565b61213d6301e133807f0000000000000000000000000000000000000000000000000000000063ae7433613c16565b42106121895760405162461bcd60e51b815260206004820152601b60248201527a16115391950e881b1a5b5a5d1959081d1a5b5948195e1c1a5c9959602a1b604482015260640161061b565b6007805490600061219983613c29565b91905055915050610781565b60018111156122f557326121b761207d565b6001600160a01b03161461221f5760405162461bcd60e51b815260206004820152602960248201527f58454e46543a206f6e6c7920454f4120616c6c6f77656420666f7220746869736044820152682063617465676f727960b81b606482015260840161061b565b6063841161223f5760405162461bcd60e51b815260040161061b90613c90565b6009818154811061225257612252613930565b906000526020600020015460016122699190613c16565b600a828154811061227c5761227c613930565b9060005260206000200154106122cc5760405162461bcd60e51b815260206004820152601560248201527416115391950e8818db185cdcc81cdbdb19081bdd5d605a1b604482015260640161061b565b600a81815481106122df576122df613930565b6000918252602082200180549161219983613c29565b6007805490600061230583613c29565b90915550949350505050565b60405160009061235590733d602d80600a3d3981f3363d3d373d3d3d363d7360601b903060601b906e5af43d82803e903d91602b57fd5bf360881b90602001613be8565b604051602081830303815290604052905060008460405160240161237b91815260200190565b60408051601f198184030181529190526020810180516001600160e01b031662dda08b60e11b179052905060008060015b6123b7896001613c16565b81101561248e576040805160208101839052908101889052600090606001604051602081830303815290604052805190602001209050808651602088016000f593506000808651602088016000885af19250826124565760405162461bcd60e51b815260206004820181905260248201527f58454e46543a204572726f72207768696c6520636c61696d696e672072616e6b604482015260640161061b565b8160010361247b5761246b848b8b8a8c612ca0565b6000898152600d60205260409020555b508061248681613c29565b9150506123ac565b50505060009384525050600b60205250604090209190915550565b612502828054806020026020016040519081016040528092919081815260200182805480156124f757602002820191906000526020600020905b8154815260200190600101908083116124e3575b505050505082612e57565b60000361251f578154600181018355600083815260209020018190555b5050565b61251f828260405180602001604052806000815250612e9f565b60008061254983611027565b9050806001600160a01b0316846001600160a01b03161480612570575061257081856117ea565b806125945750836001600160a01b031661258984610819565b6001600160a01b0316145b949350505050565b60006125f7838054806020026020016040519081016040528092919081815260200182805480156125ec57602002820191906000526020600020905b8154815260200190600101908083116125d8575b505050505083612e57565b90508015610721578254839061260f90600190613946565b8154811061261f5761261f613930565b9060005260206000200154836001836126389190613946565b8154811061264857612648613930565b90600052602060002001819055508280548061266657612666613cc4565b60019003818190600052602060002001600090559055505050565b600061268c82611027565b905061269a81600084612ed2565b6126a56000836129d8565b6001600160a01b03811660009081526004602052604081208054600192906126ce908490613946565b909155505060008281526003602052604080822080546001600160a01b0319169055518391906001600160a01b03841690600080516020613e3b833981519152908390a461251f81600084612ff3565b61251f61272961207d565b8383613037565b61274161273b61207d565b8361253d565b61275d5760405162461bcd60e51b815260040161061b90613c42565b6108fa84848484613101565b6060816000036127905750506040805180820190915260018152600360fc1b602082015290565b8160005b81156127ba57806127a481613c29565b91506127b39050600a8361385e565b9150612794565b6000816001600160401b038111156127d4576127d461360a565b6040519080825280601f01601f1916602001820160405280156127fe576020820181803683370190505b5090505b841561259457612813600183613946565b9150612820600a86613cda565b61282b906030613c16565b60f81b81838151811061284057612840613930565b60200101906001600160f81b031916908160001a905350612862600a8661385e565b9450612802565b6060815160000361288857505060408051602081019091526000815290565b6000604051806060016040528060408152602001613dfb60409139905060006003845160026128b79190613c16565b6128c1919061385e565b6128cc906004613831565b6001600160401b038111156128e3576128e361360a565b6040519080825280601f01601f19166020018201604052801561290d576020820181803683370190505b509050600182016020820185865187015b80821015612979576003820191508151603f8160121c168501518453600184019350603f81600c1c168501518453600184019350603f8160061c168501518453600184019350603f811685015184535060018301925061291e565b505060038651066001811461299557600281146129a8576129b0565b603d6001830353603d60028303536129b0565b603d60018303535b509195945050505050565b6000908152600360205260409020546001600160a01b0316151590565b600081815260056020526040902080546001600160a01b0319166001600160a01b0384169081179091558190612a0d82611027565b6001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b6000612a5133610f27565b15612a63575060131936013560601c90565b503390565b826001600160a01b0316612a7b82611027565b6001600160a01b031614612adf5760405162461bcd60e51b815260206004820152602560248201527f4552433732313a207472616e736665722066726f6d20696e636f72726563742060448201526437bbb732b960d91b606482015260840161061b565b6001600160a01b038216612b415760405162461bcd60e51b8152602060048201526024808201527f4552433732313a207472616e7366657220746f20746865207a65726f206164646044820152637265737360e01b606482015260840161061b565b612b4c838383612ed2565b612b576000826129d8565b6001600160a01b0383166000908152600460205260408120805460019290612b80908490613946565b90915550506001600160a01b0382166000908152600460205260408120805460019290612bae908490613c16565b909155505060008181526003602052604080822080546001600160a01b0319166001600160a01b038681169182179092559151849391871691600080516020613e3b83398151915291a4610721838383612ff3565b6008546000908190612c1790600190613946565b90505b8015612c975760088181548110612c3357612c33613930565b9060005260206000200154600003612c4e5750600092915050565b600160088281548110612c6357612c63613930565b9060005260206000200154612c789190613946565b831115612c855792915050565b80612c8f81613cee565b915050612c1a565b50600092915050565b600080612cae836127111190565b90506000612cbc8787613134565b90508115612ce157612ccd85612c03565b612cd8906007613c16565b60801760ff1690505b600085118015612cef575081155b15612cf8575060485b6000806000807f00000000000000000000000006450dee7fd2fb8e39061434babcfc05599a6fb86001600160a01b031663df2823318d6040518263ffffffff1660e01b8152600401612d4a9190613465565b60c060405180830381865afa158015612d67573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612d8b9190613d05565b9550955095509550505073c739d01beb34e380461bba9ef8ed1a44874382be63906029d98b868686868b60006040518863ffffffff1660e01b8152600401612e069796959493929190968752602087019590955260408601939093526060850191909152608084015260a0830152151560c082015260e00190565b602060405180830381865af4158015612e23573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612e479190613959565b9c9b505050505050505050505050565b60015b82518111612c97578183612e6f600184613946565b81518110612e7f57612e7f613930565b602002602001015103156107815780612e9781613c29565b915050612e5a565b612ea98383613161565b612eb66000848484613295565b6107215760405162461bcd60e51b815260040161061b90613d58565b6001600160a01b03831615610721576000818152600d602052604080822054905163125fb94760e11b8152600481019190915273c739d01beb34e380461bba9ef8ed1a44874382be906324bf728e90602401602060405180830381865af4158015612f41573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612f659190613959565b90506000428211612f7f57612f7a8242613946565b612f89565b612f894283613946565b905062093a8081116115155760405162461bcd60e51b815260206004820152602d60248201527f58454e46543a207472616e736665722070726f6869626974656420696e20626c60448201526c1858dadbdd5d081c195c9a5bd9609a1b606482015260840161061b565b6001600160a01b0383166000908152600f60205260409020613015908261259c565b6001600160a01b0382166000908152600f6020526040902061072190826124a9565b816001600160a01b0316836001600160a01b0316036130945760405162461bcd60e51b815260206004820152601960248201527822a9219b99189d1030b8383937bb32903a379031b0b63632b960391b604482015260640161061b565b6001600160a01b03838116600081815260066020908152604080832094871680845294825291829020805460ff191686151590811790915591519182527f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a3505050565b61310c848484612a68565b61311884848484613295565b6108fa5760405162461bcd60e51b815260040161061b90613d58565b60006007613142848461339d565b111561315057506007610781565b61315a838361339d565b9392505050565b6001600160a01b0382166131b75760405162461bcd60e51b815260206004820181905260248201527f4552433732313a206d696e7420746f20746865207a65726f2061646472657373604482015260640161061b565b6131c0816129bb565b1561320c5760405162461bcd60e51b815260206004820152601c60248201527b115490cdcc8c4e881d1bdad95b88185b1c9958591e481b5a5b9d195960221b604482015260640161061b565b61321860008383612ed2565b6001600160a01b0382166000908152600460205260408120805460019290613241908490613c16565b909155505060008181526003602052604080822080546001600160a01b0319166001600160a01b0386169081179091559051839290600080516020613e3b833981519152908290a461251f60008383612ff3565b60006001600160a01b0384163b1561339257836001600160a01b031663150b7a026132be61207d565b8786866040518563ffffffff1660e01b81526004016132e09493929190613daa565b6020604051808303816000875af192505050801561331b575060408051601f3d908101601f1916820190925261331891810190613ddd565b60015b613378573d808015613349576040519150601f19603f3d011682016040523d82523d6000602084013e61334e565b606091505b5080516000036133705760405162461bcd60e51b815260040161061b90613d58565b805181602001fd5b6001600160e01b031916630a85bd0160e11b149050612594565b506001949350505050565b6000611d4c6133ac8385613831565b61315a919061385e565b6000602082840312156133c857600080fd5b5035919050565b6001600160e01b031981168114611eb057600080fd5b6000602082840312156133f757600080fd5b813561315a816133cf565b60005b8381101561341d578181015183820152602001613405565b50506000910152565b6000815180845261343e816020860160208601613402565b601f01601f19169290920160200192915050565b60208152600061315a6020830184613426565b6001600160a01b0391909116815260200190565b6001600160a01b0381168114611eb057600080fd5b600080604083850312156134a157600080fd5b82356134ac81613479565b946020939093013593505050565b6020808252825182820181905260009190848201906040850190845b818110156134f2578351835292840192918401916001016134d6565b50909695505050505050565b60008060006060848603121561351357600080fd5b833561351e81613479565b9250602084013561352e81613479565b929592945050506040919091013590565b6000806040838503121561355257600080fd5b50508035926020909101359150565b6001600160a01b03929092168252602082015260400190565b60008060006060848603121561358f57600080fd5b505081359360208301359350604090920135919050565b6000602082840312156135b857600080fd5b813561315a81613479565b8015158114611eb057600080fd5b600080604083850312156135e457600080fd5b82356135ef81613479565b915060208301356135ff816135c3565b809150509250929050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f191681016001600160401b03811182821017156136485761364861360a565b604052919050565b60006001600160401b038211156136695761366961360a565b50601f01601f191660200190565b6000806000806080858703121561368d57600080fd5b843561369881613479565b935060208501356136a881613479565b92506040850135915060608501356001600160401b038111156136ca57600080fd5b8501601f810187136136db57600080fd5b80356136ee6136e982613650565b613620565b81815288602083850101111561370357600080fd5b8160208401602083013760006020838301015280935050505092959194509250565b6000806040838503121561373857600080fd5b823561374381613479565b915060208301356135ff81613479565b6000806040838503121561376657600080fd5b8235915060208301356135ff81613479565b60208082526017908201527616115388141c9bde1e4e881d5b985d5d1a1bdc9a5e9959604a1b604082015260600190565b600081516137bb818560208601613402565b9290920192915050565b600082516137d7818460208701613402565b9190910192915050565b600181811c908216806137f557607f821691505b60208210810361381557634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b80820281158282048414176107815761078161381b565b634e487b7160e01b600052601260045260246000fd5b60008261386d5761386d613848565b500490565b60208082526015908201527416115391950e88139bdd081858dd1a5d99481e595d605a1b604082015260600190565b6020808252601a908201527916115391950e881c99595b9d1c985b98de4819195d1958dd195960321b604082015260600190565b60208082526014908201527316115391950e88125b1b1959d85b0818dbdd5b9d60621b604082015260600190565b60208082526013908201527258454e46543a20496c6c6567616c207465726d60681b604082015260600190565b634e487b7160e01b600052603260045260246000fd5b818103818111156107815761078161381b565b60006020828403121561396b57600080fd5b5051919050565b6001600160a01b0392831681529116602082015260400190565b602080825260189082015277115490cdcc8c4e881a5b9d985b1a59081d1bdad95b88125160421b604082015260600190565b6020808252601a908201527916115391950e881499595b9d1c985b98de4819195d1958dd195960321b604082015260600190565b600060208284031215613a0457600080fd5b815161315a816135c3565b600060208284031215613a2157600080fd5b81516001600160401b03811115613a3757600080fd5b8201601f81018413613a4857600080fd5b8051613a566136e982613650565b818152856020838501011115613a6b57600080fd5b613a7c826020830160208601613402565b95945050505050565b607b60f81b815275226e616d65223a202258454e20546f7272656e74202360501b60018201528351600090613ac1816017850160208901613402565b61088b60f21b60179184019182018190527f226465736372697074696f6e223a202258454e46543a2058454e2043727970746019830152721bc8135a5b9d1a5b99c8151bdc9c995b9d088b606a1b6039830152691134b6b0b3b2911d101160b11b604c8301527919185d184e9a5b5859d94bdcdd99cade1b5b0ed8985cd94d8d0b60321b60568301528551613b5d816070850160208a01613402565b60709201918201526d01130ba3a3934b13aba32b9911d160951b6072820152613b99613b8c60808301866137a9565b607d60f81b815260010190565b9695505050505050565b7f646174613a6170706c69636174696f6e2f6a736f6e3b6261736536342c000000815260008251613bdb81601d850160208701613402565b91909101601d0192915050565b6001600160601b031993841681529190921660148201526001600160881b0319909116602882015260370190565b808201808211156107815761078161381b565b600060018201613c3b57613c3b61381b565b5060010190565b6020808252602e908201527f4552433732313a2063616c6c6572206973206e6f7420746f6b656e206f776e6560408201526d1c881b9bdc88185c1c1c9bdd995960921b606082015260800190565b6020808252601a908201527916115391950e881d5b99195c881c995c481593554818dbdd5b9d60321b604082015260600190565b634e487b7160e01b600052603160045260246000fd5b600082613ce957613ce9613848565b500690565b600081613cfd57613cfd61381b565b506000190190565b60008060008060008060c08789031215613d1e57600080fd5b8651613d2981613479565b6020880151604089015160608a015160808b015160a0909b0151939c929b509099909850965090945092505050565b60208082526032908201527f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560408201527131b2b4bb32b91034b6b83632b6b2b73a32b960711b606082015260800190565b6001600160a01b0385811682528416602082015260408101839052608060608201819052600090613b9990830184613426565b600060208284031215613def57600080fd5b815161315a816133cf56fe4142434445464748494a4b4c4d4e4f505152535455565758595a6162636465666768696a6b6c6d6e6f707172737475767778797a303132333435363738392b2fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef404d724a61636b4c6576696e20406c62656c79616576206661697263727970746f2e6f7267a2646970667358221220900a6e3ce3545819bd9f522b427e40c33ce4b2890964e701e3a093f650d07a6464736f6c63430008110033"
    );
    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertTrue(json.get("is_erc721").asBoolean());
  }

  @Test
  void evalTestERC1155() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0x7821da7428f6f838c344b89b6e03e51bcb856dd5",
            "0x363d3d373d3d3d363d739bc90f1ed1a21e8ddca57c0fa0e3cf23f302db6e5af43d82803e903d91602b57fd5bf3"
    );

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertTrue(json.get("is_erc1155").asBoolean());
    Assertions.assertEquals("Airdrop: Lido Deploy", json.get("name").asText());
    Assertions.assertEquals("Lido", json.get("symbol").asText());
  }

  @Test
  void evalTestNormalContract() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0x4aa1435681067b16883e6a331c74e3a796047ffb",
            "0x363d3d373d3d3d363d7310692b1c144ef98904335e40ce857369d19b83335af43d82803e903d91602b57fd5bf3"
    );

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertTrue(json.get("is_proxy").asBoolean());
    Assertions.assertFalse(json.get("is_erc20").asBoolean());
    Assertions.assertFalse(json.get("is_erc721").asBoolean());
    Assertions.assertFalse(json.get("is_erc1155").asBoolean());
  }

  @Test
  void evalTest_WithEmptyByteCode() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0x7821da7428f6f838c344b89b6e03e51bcb856dd5",
            ""
    );

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertEquals("Airdrop: Lido Deploy", json.get("name").asText());
    Assertions.assertEquals("Lido", json.get("symbol").asText());
  }

  @Test
  void evalTest_WithHitCache() {
    String result = tokenMeta.eval("https://rpc.ankr.com/eth",
            "0x7821da7428f6f838c344b89b6e03e51bcb856dd5", "");

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertEquals("Airdrop: Lido Deploy", json.get("name").asText());
    Assertions.assertEquals("Lido", json.get("symbol").asText());

    result = tokenMeta.eval("https://rpc.ankr.com/eth",
            "0x7821da7428f6f838c344b89b6e03e51bcb856dd5", "");

    json = JSONUtils.toJSONObject(result);
    Assertions.assertEquals("Airdrop: Lido Deploy", json.get("name").asText());
    Assertions.assertEquals("Lido", json.get("symbol").asText());
  }

  @Test
  void evalTest_Proxy() {
    String result = tokenMeta.eval("https://rpc.ankr.com/eth",
            "0x88909D489678dD17aA6D9609F89B0419Bf78FD9a",
            "0x6080604052600a600c565b005b60186014601a565b605e565b565b600060597f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc5473ffffffffffffffffffffffffffffffffffffffff1690565b905090565b3660008037600080366000845af43d6000803e808015607c573d6000f35b3d6000fdfea2646970667358221220bad9f1e612f56f021ac7ae7b2d6f9c9e4864b85e75f411424add1986fad555ec64736f6c63430008140033");

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertEquals("Layer3", json.get("name").asText());
    Assertions.assertEquals("L3", json.get("symbol").asText());
    Assertions.assertEquals(18, json.get("decimals").asInt());
    Assertions.assertTrue(json.get("is_erc20").asBoolean());
    Assertions.assertFalse(json.get("is_erc721").asBoolean());
  }


  @Test
  void evalTestERC20Bytes() {
    String result = tokenMeta.eval(
            "https://rpc.ankr.com/eth",
            "0xd5c228427c7708a2c78ea5026b6fed44d86b7066",
            (byte[]) null
    );

    JsonNode json = JSONUtils.toJSONObject(result);
    Assertions.assertTrue(json.get("is_erc20").asBoolean());
    Assertions.assertEquals("HOBA", json.get("symbol").asText());
    Assertions.assertEquals("HOBA Inu", json.get("name").asText());
    Assertions.assertEquals(9, json.get("decimals").asInt());
  }
}